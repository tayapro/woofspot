{% extends "base.html" %}

{% block content %}

<div class="text-center mt-5 mt-md-0 pt-5 pt-md-0 my-4">
    <h2 class="bold-header-font text-black text-opacity-50">Profile</h2>
</div>

<div class="profile-container d-flex flex-column flex-md-row 
    mt-3 mb-5 pt-3 pb-5 mb-md-0 pb-md-0 mx-3 mx-md-0
    justify-content-center gap-2">
    {% if user.is_authenticated %}
    {% if latest_message %}
    <div class="alert {{ latest_message.tags }} alert-dismissible fade show" role="alert">
        {{ latest_message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- User Details Card -->
    <div class="col-12 col-md-6 d-flex flex-column justify-content-center">
        <div class="card border-secondary">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">User Details</h5>
            </div>
            <div class="card-body">
                <p class="mb-2"><strong>Username:</strong> {{ user.username }}</p>
                <p class="mb-0"><strong>Email:</strong> {{ user.email }}</p>
            </div>
        </div>
    </div>

    <div class="update-user-details-section px-4 z-1 col-12 col-md-6 d-flex flex-column justify-content-center">
        <div class="accordion" id="faqAccordion">

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        Change Username
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
                    data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <form method="POST" action="{% url 'change_username' %}?next={{request.path}}" class="mt-3">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="new_username" class="form-label fw-semibold">New Username:</label>
                                <input type="text" id="new_username" name="new_username"
                                    class="form-control text-body-secondary text-opacity-75"
                                    placeholder="Enter your new username" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 fw-semibold">Update Username</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Change Email
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                    data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        <form method="POST" action="{% url 'change_email' %}?next={{request.path}}" class="mt-3">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="email" class="form-label fw-semibold">New Email Address:</label>
                                <input type="email" id="email" name="email"
                                    class="form-control text-body-secondary text-opacity-75"
                                    placeholder="Enter your new email" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 fw-semibold">Change Email</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Forbidden Page Message -->
    <div class="forbidden-page text-center py-5">
        <h4 class="text-danger">Access Denied</h4>
        <p>You do not have permission to view this page.</p>
        <a href="{% url 'home' %}" class="btn btn-outline-secondary">
            <i class="fa-solid fa-house me-2"></i>Return to Home
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}